<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fuegos Artificiales con Estrellas</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.min.js"></script>

  <script>
  let scene, camera, renderer, fireworks = [];
  let stars, starMaterial;
  let hue = 0;

  init();
  animate();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
    camera.position.z = 600;

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 🌌 Crear cielo estrellado
    createStars();

    // 🎆 Lanza un nuevo fuego artificial cada 1.5s
    setInterval(() => {
      createFirework();
    }, 1500);

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  }

  // 🌌 Crear estrellas
  function createStars() {
    const starCount = 2000;
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(starCount * 3);

    for (let i = 0; i < starCount; i++) {
      positions[i*3]   = (Math.random() - 0.5) * 2000;
      positions[i*3+1] = (Math.random() - 0.5) * 2000;
      positions[i*3+2] = (Math.random() - 0.5) * 2000;
    }

    geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

    const texture = new THREE.TextureLoader().load(
      "https://cdn.jsdelivr.net/gh/mrdoob/three.js/examples/textures/sprites/disc.png"
    );

    starMaterial = new THREE.PointsMaterial({
      size: 2,
      map: texture,
      transparent: true,
      opacity: 0.8,
      depthWrite: false,
      blending: THREE.AdditiveBlending,
      color: 0xffffff
    });

    stars = new THREE.Points(geometry, starMaterial);
    scene.add(stars);
  }

  // 🔥 Crear un fuego artificial
  function createFirework() {
    let particleCount = 1000;
    let geometry = new THREE.BufferGeometry();
    let positions = new Float32Array(particleCount * 3);
    let velocities = [];

    let variant = Math.floor(Math.random() * 8); // 8 variantes
    let centerX = (Math.random() - 0.5) * 800;
    let centerY = (Math.random() - 0.2) * 500;
    let centerZ = (Math.random() - 0.5) * 800;

    for (let i = 0; i < particleCount; i++) {
      let x = centerX, y = centerY, z = centerZ;
      let vx, vy, vz;

      if (variant === 0) {
        // 🌐 Esfera clásica
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos(2 * Math.random() - 1);
        let r = Math.random() * 8;
        vx = Math.sin(phi) * Math.cos(theta) * r;
        vy = Math.sin(phi) * Math.sin(theta) * r;
        vz = Math.cos(phi) * r;

      } else if (variant === 1) {
        // 🟢 Anillo plano
        let angle = Math.random() * Math.PI * 2;
        let r = Math.random() * 8 + 4;
        vx = Math.cos(angle) * r;
        vy = Math.sin(angle) * r;
        vz = (Math.random() - 0.5) * 3;

      } else if (variant === 2) {
        // 🌀 Espiral ascendente
        let angle = i * 0.1;
        let r = i * 0.02;
        vx = Math.cos(angle) * r * 2;
        vy = Math.sin(angle) * r * 2;
        vz = i * 0.01;

      } else if (variant === 3) {
        // ⭐ Estrella
        let angle = Math.random() * Math.PI * 2;
        let r = (Math.random() < 0.5 ? 10 : 4);
        vx = Math.cos(angle) * r;
        vy = Math.sin(angle) * r;
        vz = (Math.random() - 0.5) * 3;

      } else if (variant === 4) {
        // ❤️ Corazón
        let t = Math.random() * Math.PI * 2;
        let xh = 16 * Math.pow(Math.sin(t), 3);
        let yh = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
        vx = xh * 0.6;
        vy = yh * 0.6;
        vz = (Math.random() - 0.5) * 5;

      } else if (variant === 5) {
        // 🌸 Flor
        let petals = 6;
        let t = Math.random() * Math.PI * 2;
        let r = Math.sin(petals * t) * 10;
        vx = Math.cos(t) * r;
        vy = Math.sin(t) * r;
        vz = (Math.random() - 0.5) * 4;

      } else if (variant === 6) {
        // ✨ Constelación dispersa
        vx = (Math.random() - 0.5) * 15;
        vy = (Math.random() - 0.5) * 15;
        vz = (Math.random() - 0.5) * 15;

      } else {
        // 💥 Multi-explosión
        let offsetX = (Math.random() - 0.5) * 50;
        let offsetY = (Math.random() - 0.5) * 50;
        let offsetZ = (Math.random() - 0.5) * 50;
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos(2 * Math.random() - 1);
        let r = Math.random() * 6;
        vx = offsetX + Math.sin(phi) * Math.cos(theta) * r;
        vy = offsetY + Math.sin(phi) * Math.sin(theta) * r;
        vz = offsetZ + Math.cos(phi) * r;
      }

      positions[i*3] = x;
      positions[i*3+1] = y;
      positions[i*3+2] = z;
      velocities.push({vx, vy, vz});
    }

    geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

    const texture = new THREE.TextureLoader().load(
      "https://cdn.jsdelivr.net/gh/mrdoob/three.js/examples/textures/sprites/disc.png"
    );

    const material = new THREE.PointsMaterial({
      size: 4,
      map: texture,
      transparent: true,
      blending: THREE.AdditiveBlending,
      depthWrite: false,
      color: new THREE.Color(`hsl(${Math.random()*360}, 100%, 60%)`)
    });

    let points = new THREE.Points(geometry, material);

    fireworks.push({points, velocities, life: 200, material});
    scene.add(points);
  }

  function animate() {
    requestAnimationFrame(animate);

    // ✨ Parpadeo de estrellas
    starMaterial.opacity = 0.7 + Math.sin(Date.now() * 0.002) * 0.3;

    // 🎆 Animar fuegos artificiales
    fireworks.forEach((fw, index) => {
      let positions = fw.points.geometry.attributes.position.array;
      for (let i = 0; i < positions.length/3; i++) {
        positions[i*3]   += fw.velocities[i].vx;
        positions[i*3+1] += fw.velocities[i].vy;
        positions[i*3+2] += fw.velocities[i].vz;

        // Gravedad
        fw.velocities[i].vy -= 0.02;
      }
      fw.points.geometry.attributes.position.needsUpdate = true;

      // 🌈 Cambia color dinámicamente
      hue = (hue + 1) % 360;
      fw.material.color.setHSL(hue/360, 1, 0.6);

      fw.life--;
      if (fw.life <= 0) {
        scene.remove(fw.points);
        fireworks.splice(index, 1);
      }
    });

    renderer.render(scene, camera);
  }
  </script>
</body>
</html>
